"use strict";var invalidCardErrorMessage="Some error happened. Please, verify the data of your card and try again.";function ElementsObserver(r){var t=[],a=[];function n(e){var n;n=e,a.forEach(function(e){e&&e(n)}),r.every(function(e){return e.value&&e.value.trim().length})&&t.forEach(function(e){e&&e()})}return r.forEach(function(e){e.addEventListener("change",function(e){n(e.target)},!1)}),{addCompletionCallback:function(e){return t.push(e),this},addChangeCallback:function(e){return a.push(e),this}}}var waitFor=function(n,r){var t=setInterval(function(){var e=n();if(null==e)return!1;clearInterval(t),r(e)},500)},hasClass=function(e,n){return-1<(" "+e.className+" ").indexOf(" "+n+" ")},resetValidations=function(e,n){Array.from(e.querySelectorAll(n)).forEach(function(e){e.classList.remove("required-entry","validation-failed","brand-required"),e.nextElementSibling&&hasClass(e.nextElementSibling,"validation-advice")&&(e.nextElementSibling.style.display="none")})},addRequiredClassToInputs=function(e,n,r,t){resetValidations(r,t),Array.from(e).forEach(function(e){e.classList.add(n),hasClass(e,"hidden-input-brand")&&(e.classList.add("brand-required"),e.classList.remove("required-entry"))})},validationFormListener=function(n,e){var r=".required-entry-input",t=".required-entry-select";Array.from(e).forEach(function(e){e.querySelector("input[type=radio]").addEventListener("change",function(e){addRequiredClassToInputs(e.target.parentElement.querySelectorAll(r),"required-entry",n,r),addRequiredClassToInputs(e.target.parentElement.querySelectorAll(t),"validate-select",n,t)})})},initCreditCardOption=function(e,n){var r=e.querySelector("input[type=radio]"),t=".required-entry-input";r.checked=!0,addRequiredClassToInputs(r.parentElement.querySelectorAll(t),"required-entry",n,t)},initCreditCardWithoutSavedCards=function(e){e.querySelectorAll(".required-entry-input").forEach(function(e){e.classList.add("required-entry")}),e.querySelectorAll(".required-entry-select").forEach(function(e){e.classList.add("validate-select")})},initCreditCardForm=function(e,n){0!==e.length?(validationFormListener(n,e),initCreditCardOption(e[0],n)):initCreditCardWithoutSavedCards(n)},handleEbanxForm=function(e,n,r){waitFor(function(){return document.querySelector("#"+r)},function(e){var n=e.querySelectorAll(".ebanx-credit-card-option");initCreditCardForm(n,e)});var t=function(e){return document.getElementById(e)},a=null,i=t("ebanx_"+n+"_"+e+"_"+n+"_name"),d=t("ebanx_"+n+"_"+e+"_"+n+"_number"),o=t("ebanx_"+n+"_"+e+"_expiration"),u=t("ebanx_"+n+"_"+e+"_expiration_yr"),l=t("ebanx_"+n+"_"+e+"_"+n+"_cid"),s=t("ebanx_"+n+"_"+e+"_token"),c=t("ebanx_"+n+"_"+e+"_brand"),v=t("ebanx_"+n+"_"+e+"_masked_card_number"),f=t("ebanx_"+n+"_"+e+"_device_fingerprint"),_=t("ebanx_"+n+"_"+e+"_mode"),m=t("ebanx_"+n+"_"+e+"_integration_key"),y=t("ebanx_"+n+"_"+e+"_country"),b=t("ebanx-error-message"),p=void 0!==t("payment_form_ebanx_"+n+"_"+e),h="sandbox"===_.value?"test":"production",E=null;EBANX.config.setMode(h),EBANX.config.setPublishableKey(m.value),EBANX.config.setCountry(y.value);var C=function(e){var n=document.querySelector("#review-buttons-container > button");void 0!==n&&n&&(n.disabled=e)},g=function(e){return b.innerHTML=e,C(!1),setTimeout(function(){Validation.showAdvice({advices:!1},b,"ebanx-error-message")},500),!1},x=function(e){if(!e.data.token)return g(invalidCardErrorMessage);if(!e.data.hasOwnProperty("status")){var n=e.error.err,r=n.message;return n.message||(EBANX.errors.InvalidValueFieldError(n.status_code),r=EBANX.errors.message||invalidCardErrorMessage),g(r)}a=e.data,s.value=a.token,c.value=a.payment_type_code,v.value=a.masked_card_number,f.value=a.deviceId,C(!1),function(e){if(!e)return;var n=document.createEvent("Event");n.initEvent("click",!0,!0),e.dispatchEvent(n)}(E)};p&&ElementsObserver([i,d,o,u,l]).addChangeCallback(function(){a=null,s.value="",c.value="",v.value="",f.value="",Validation.hideAdvice({advices:!1},b)}).addCompletionCallback(function(e){!e||"button"!==e.type&&"span"!==e.type||(E=e),a||(C(!0),EBANX.card.createToken({card_number:parseInt(d.value.replace(/ /g,"")),card_name:i.value,card_due_date:(parseInt(o.value)||0)+"/"+(parseInt(u.value)||0),card_cvv:l.value},x))}),d.addEventListener("input",function(e){setInterval(function(){l.setAttribute("maxlength",3),-1<(" "+e.target.className+" ").indexOf(" amex ")&&l.setAttribute("maxlength",4),-1<(" "+e.target.className+" ").indexOf(" unknown ")&&(l.value="")},200)})};
//# sourceMappingURL=checkout.js.map
